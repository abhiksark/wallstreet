{% extends "base.html" %}

{% block content %}
  <p>Welcome {{ name }}</p>
<table>
  <tr>
    <td>  
<form method="Post" action=".">{% csrf_token %}
    <table>{{ form.as_table }}</table>

 
</form>
    </td>
    <td>
  <table >
    <tr>
      <td >
        <table border=2><tr><td>
        <div id="demo"></div>
        </td></tr></table>
      </td></tr>
      <tr height =30><td>
       <div id="timer">refresh in : 20</div>
      </td>
    </tr>
  </table>
</td>
</tr>
</table>
<br>
<br>

<button type="button" onclick="loadDoc()">refresh</button>

<script>
function loadDoc() {
 var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (xhttp.readyState == 4 && xhttp.status == 200) {
      document.getElementById("demo").innerHTML = xhttp.responseText;
    }
  };
  xhttp.open("GET", "http://127.0.0.1:8000/current_price/", true);
  xhttp.send();
  }
 
//#################################################################################################
setInterval(function(){
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {var response_data=xhttp.responseText;
     if(response_data=='0'||response_data=='1'){loadDoc();}
      document.getElementById("timer").innerHTML = "refresh in : "+response_data+" sec";
  
  };
  xhttp.open("GET", "http://127.0.0.1:8000/timer_update/", true);
  xhttp.send();}, 990);

//################################################################################################3
 /*setInterval(function(){
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (xhttp.readyState == 4 && xhttp.status == 200) {
      document.getElementById("demo").innerHTML = xhttp.responseText;
    }
  };
  xhttp.open("GET", "http://127.0.0.1:8000/current_price/", true);
  xhttp.send();}, 25800);
*/
</script>
  <form method="GET" action=".">
 
        <input type="submit" value="BUY" />
        <input type="submit" value="SELL" name = "sell"/>
        <input type="hidden" name="next" value="/home" />
    </form>
    <br>
{% endblock %}